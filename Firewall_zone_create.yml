---
- name: Configure Firewall Zone
  hosts: all
  become: true
  vars:
    firewall_zone: ansi_zone
    firewall_zone_description: "default: REJECT, allowed: ssh, Samba"

  tasks:
    # Create the firewall zone
    - name: Create firewall zone
      firewalld_zone:
        name: "{{ firewall_zone }}"
        state: present
        permanent: yes
        immediate: yes
        description: "{{ firewall_zone_description }}"

    # Set the default policy to REJECT
    - name: Set default policy to REJECT
      firewalld:
        zone: "{{ firewall_zone }}"
        state: enabled
        permanent: yes
        immediate: yes
        rich_rule: 'rule family="ipv4" source NOT address="127.0.0.1/8" reject'

    # Allow SSH service in the firewall zone
    - name: Allow SSH service
      firewalld:
        zone: "{{ firewall_zone }}"
        state: enabled
        service: ssh
        permanent: yes
        immediate: yes

    # Allow Samba service on port 4312 in the firewall zone
    - name: Allow Samba service on port 4312
      firewalld:
        zone: "{{ firewall_zone }}"
        state: enabled
        port: 4312/tcp
        permanent: yes
        immediate: yes
